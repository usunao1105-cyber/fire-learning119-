<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>消防職員向けe-Learning：エトミデート特別講座</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f3f4f6;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
        h1, h2, h3, .serif {
            font-family: 'Noto Serif JP', serif;
        }
        .luxury-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        .btn-hover {
            transition: all 0.3s ease;
        }
        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .option-radio:checked + label {
            background-color: #1e3a8a; /* blue-900 */
            color: white;
            border-color: #1e3a8a;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-gray-800 antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-slate-900 text-white py-6 border-b-4 border-amber-600 shadow-lg">
        <div class="container mx-auto px-4 text-center">
            <p class="text-amber-500 text-sm tracking-widest font-bold mb-2 uppercase">Fire Service Education System</p>
            <h1 class="text-3xl md:text-4xl font-bold tracking-wide">エトミデートに関する知識確認</h1>
            <p class="mt-2 text-slate-400 text-sm md:text-base font-light">救急活動・予防業務における専門知識の習得</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-4xl">
        
        <!-- Welcome Screen -->
        <div id="start-screen" class="bg-white rounded-lg luxury-shadow p-8 md:p-12 text-center fade-in border-t-2 border-slate-100">
            <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-slate-800 mb-4">学習を開始します</h2>
            <p class="text-gray-600 mb-8 leading-relaxed">
                全50問のデータベースから、ランダムに<span class="font-bold text-amber-700">10問</span>が出題されます。<br>
                基礎薬理、救急現場対応、法的規制について確認を行います。<br>
                準備ができたら下のボタンを押してください。
            </p>
            <button onclick="startQuiz()" class="btn-hover bg-slate-900 text-white px-10 py-4 rounded-md font-bold text-lg border border-slate-900 hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-900">
                演習を開始する
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div id="question-container" class="space-y-8">
                <!-- Questions will be injected here -->
            </div>
            
            <div class="mt-12 text-center">
                <button onclick="gradeQuiz()" class="btn-hover bg-amber-700 text-white px-12 py-4 rounded-md font-bold text-lg shadow-md hover:bg-amber-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-600 w-full md:w-auto">
                    採点する
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden fade-in">
            <div class="bg-slate-900 text-white rounded-lg shadow-xl p-8 mb-8 text-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-amber-500"></div>
                <h2 class="text-xl md:text-2xl font-light mb-2 opacity-80">確認結果</h2>
                <div class="text-5xl md:text-6xl font-bold my-4 serif tracking-tighter">
                    <span id="score-display" class="text-amber-400">0</span>
                    <span class="text-2xl text-slate-400 font-normal">/ 10</span>
                </div>
                <p id="score-message" class="text-sm md:text-base text-slate-300"></p>
            </div>

            <div id="review-container" class="space-y-6">
                <!-- Review items will be injected here -->
            </div>

            <div class="mt-12 text-center pb-12">
                <button onclick="restartQuiz()" class="btn-hover bg-slate-800 text-white px-10 py-4 rounded-md font-bold text-lg border border-slate-700 hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-700">
                    再度挑戦する
                </button>
                <p class="mt-4 text-sm text-gray-500">※問題はランダムに再抽選されます</p>
            </div>
        </div>

    </main>

    <footer class="bg-gray-200 text-gray-500 py-6 text-center text-xs mt-auto">
        <p>&copy; Fire Department Education e-Learning System.</p>
    </footer>

    <script>
        // --- Data: 50 Questions ---
        // A=0, B=1, C=2, D=3
        const allQuestions = [
            // 第1章：基礎知識・薬理
            { q: "エトミデートの主な薬理作用として正しいものはどれですか？", options: ["強力な鎮痛作用", "催眠・鎮静作用", "筋弛緩作用", "血糖降下作用"], a: 1, exp: "エトミデートは催眠・鎮静作用を持つ静脈麻酔薬ですが、鎮痛作用はありません。" },
            { q: "エトミデートが作用する主な受容体はどれですか？", options: ["オピオイド受容体", "NMDA受容体", "GABA-A受容体", "アドレナリン受容体"], a: 2, exp: "エトミデートは脳内のGABA-A受容体に結合し、抑制性神経伝達を増強することで鎮静効果を発揮します。" },
            { q: "医療現場でエトミデートが挿管時の導入薬として好まれる主な理由は何ですか？", options: ["鎮痛効果が高いため", "呼吸抑制が強いため", "心血管系への影響が少ないため", "作用時間が非常に長いため"], a: 2, exp: "他の導入剤に比べ、血圧低下や心拍数の変動が少なく、血行動態が安定しているため、ショック状態や心疾患のある患者に適しています。" },
            { q: "エトミデートの静脈内投与後の作用発現時間はどのくらいですか？", options: ["30～60秒", "5～10分", "30分", "1時間"], a: 0, exp: "即効性があり、静脈内投与後、通常30～60秒（1分以内）で意識消失などの効果が現れます。" },
            { q: "標準的な単回投与におけるエトミデートの作用持続時間はどのくらいですか？", options: ["1分未満", "3～5分", "30～60分", "3～4時間"], a: 1, exp: "代謝と再分布が早いため、標準的な導入量での作用持続時間は約3～5分と短時間です。" },
            { q: "エトミデートの投与によって生じる特徴的な内分泌系の副作用はどれですか？", options: ["甲状腺機能亢進症", "インスリン分泌過多", "副腎皮質ホルモン合成の阻害", "成長ホルモンの分泌促進"], a: 2, exp: "副腎の酵素を阻害し、コルチゾールやアルドステロンの合成を抑制します。これにより副腎不全のリスクが生じます。" },
            { q: "エトミデートによる副腎抑制の主な原因となる阻害酵素はどれですか？", options: ["11β-ヒドロキシラーゼ", "21-ヒドロキシラーゼ", "アロマターゼ", "アンジオテンシン変換酵素"], a: 0, exp: "エトミデートは、ステロイド合成経路にある11β-ヒドロキシラーゼを用量依存的かつ可逆的に阻害します。" },
            { q: "エトミデートの副作用として、投与時に高頻度で見られる不随意運動を何と呼びますか？", options: ["アカシジア", "ミオクローヌス", "ジストニア", "パーキンソニズム"], a: 1, exp: "導入時、約30～60%の患者にミオクローヌス（筋肉の短時間のけいれんやひきつり）が見られます。" },
            { q: "エトミデート投与時に生じるミオクローヌスを軽減するために有効な前処置薬はどれですか？", options: ["アスピリン", "オピオイドやベンゾジアゼピン", "アドレナリン", "インスリン"], a: 1, exp: "フェンタニルなどのオピオイドや、ミダゾラムなどのベンゾジアゼピン系薬剤を前投与することで、発生率や重症度を軽減できます。" },
            { q: "エトミデートの注射時によく見られる局所的な副作用は何ですか？", options: ["血管痛（注射部位疼痛）", "皮膚の壊死", "神経麻痺", "色素沈着"], a: 0, exp: "エトミデート製剤（特にプロピレングリコールを含むもの）は、静脈内投与時に痛み（血管痛）を伴う頻度が高いことが知られています。" },
            { q: "エトミデートは頭蓋内圧（ICP）に対してどのような影響を与えますか？", options: ["著しく上昇させる", "変化させない", "低下させる（または維持する）", "変動幅を大きくする"], a: 2, exp: "脳血流量と脳代謝率を低下させるため、頭蓋内圧（ICP）を低下させる効果があります。頭部外傷患者に適している場合があります。" },
            { q: "エトミデートには鎮痛作用がないため、痛みを伴う処置の際に併用すべき薬剤はどれですか？", options: ["筋弛緩薬", "オピオイド（鎮痛薬）", "利尿薬", "抗生物質"], a: 1, exp: "鎮痛効果がないため、手術や挿管などの痛みを伴う処置では、フェンタニルなどのオピオイドを併用する必要があります。" },
            { q: "敗血症性ショックの患者にエトミデートを使用する際、最も懸念されるリスクはどれですか？", options: ["不整脈の誘発", "腎不全の悪化", "副腎不全による死亡率の増加", "肝機能障害"], a: 2, exp: "敗血症患者において、副腎抑制が死亡率を増加させる可能性（または副腎不全のリスク）が議論されています。" },
            { q: "エトミデートの代謝は主にどの臓器で行われますか？", options: ["腎臓", "肺", "肝臓", "脾臓"], a: 2, exp: "主に肝臓のエステラーゼによって加水分解され、不活性な代謝物に変換されます。" },
            { q: "妊娠中のエトミデートの使用に関する記述として正しいものはどれですか？", options: ["完全に安全であると証明されている", "催奇形性があるため絶対禁忌である", "有益性がリスクを上回る場合のみ使用する", "推奨される第一選択薬である"], a: 2, exp: "妊婦に対する十分な対照研究はなく、治療上の有益性が危険性を上回ると判断される場合にのみ使用すべきとされています。" },

            // 第2章：違法乱用と「ゾンビたばこ」
            { q: "エトミデートが含まれる違法な電子タバコ用リキッドの一般的な通称は何ですか？", options: ["ドリームウォーター", "スペースオイル（Space Oil）", "マジックリキッド", "ハッピーガス"], a: 1, exp: "その浮遊感や効果から「スペースオイル（宇宙の油）」や「上頭煙」などと呼ばれています。" },
            { q: "エトミデート含有製品が「ゾンビたばこ」と呼ばれるようになった主な理由は何ですか？", options: ["使用者の顔色が青白くなるから", "意識障害や不随意運動を起こしゾンビのように見えるから", "死者が蘇るような効果があるから", "映画の小道具として使われたから"], a: 1, exp: "意識が朦朧とし、手足の震えや筋肉の硬直、ふらつきながら歩く様子が「ゾンビ」に例えられたためです。" },
            { q: "「スペースオイル」という呼び名の由来の一つである、エトミデートの作用の特徴はどれですか？", options: ["効果が数日間持続する", "宇宙の味がする", "「宇宙に浮いているような」感覚と素早い発現・消失", "視力が良くなり星が見えるようになる"], a: 2, exp: "「宇宙に浮いているような」感覚が得られることや、効果が急速に現れてすぐに消える特徴から名付けられました。" },
            { q: "日本において、エトミデートが「指定薬物」として規制されたのはいつですか？", options: ["2020年1月", "2023年8月", "2025年5月", "2030年12月"], a: 2, exp: "2025年（令和7年）5月16日に公布され、5月26日に指定薬物として規制が施行されました。" },
            { q: "エトミデートが指定薬物に指定されたことにより、禁止された行為に含まれないものはどれですか？", options: ["輸入", "所持", "正当な医療研究用途での使用", "個人的な使用"], a: 2, exp: "医療等の正当な用途（国の機関や大学での学術研究など）を除き、輸入、製造、販売、所持、使用などが禁止されています。" },
            { q: "指定薬物であるエトミデートを個人的に使用・所持した場合の罰則（医薬品医療機器等法）として正しいものはどれですか？", options: ["厳重注意のみ", "1年以下の懲役または50万円以下の罰金", "3年以下の懲役もしくは300万円以下の罰金", "10年以上の懲役"], a: 2, exp: "個人的な使用・所持等の違反には、3年以下の懲役もしくは300万円以下の罰金、またはその両方が科されます。" },
            { q: "エトミデートの乱用による急性中毒症状として、正しい組み合わせはどれですか？", options: ["異常な高揚感と活動性亢進", "意識障害、不随意運動、呼吸抑制", "激しい空腹感と体重増加", "皮膚の乾燥と脱毛"], a: 1, exp: "乱用（急性中毒）では、意識の混濁や消失、手足の激しい震えや硬直、呼吸数の減少などが生じます。" },
            { q: "エトミデートの乱用が原因で引き起こされる二次的な被害として、実際に報告されているものはどれですか？", options: ["交通事故や意識消失時の犯罪被害", "集団食中毒", "建物の倒壊", "コンピュータウイルスの拡散"], a: 0, exp: "運転中に意識を喪失して交通事故を起こしたり、意識を失っている間に犯罪被害に遭ったりするリスクが報告されています。" },
            { q: "「ゾンビたばこ」などの危険ドラッグは、SNSなどでどのように偽って販売されることがありますか？", options: ["「劇薬です」", "「合法」「リラックスリキッド」", "「毒物です」", "「警察公認」"], a: 1, exp: "「合法」を装ったり、「リラックスリキッド」「スリープカートリッジ」などと称して、違法性を隠して販売されます。" },
            { q: "エトミデートの長期的な乱用により、特に女性で懸念されるホルモン異常の症状はどれですか？", options: ["女性ホルモンの過剰分泌", "高アンドロゲン血症（ニキビ、多毛など）", "骨密度の急激な上昇", "甲状腺機能の低下"], a: 1, exp: "ステロイド合成阻害の結果、前駆物質がアンドロゲン合成経路に回り、多毛やニキビなどの高アンドロゲン血症を引き起こす可能性があります。" },
            { q: "エトミデートの乱用に関連して報告されている電解質異常はどれですか？", options: ["高ナトリウム血症", "低カリウム血症", "高カルシウム血症", "低マグネシウム血症"], a: 1, exp: "鉱質コルチコイド経路への影響等により、低カリウム血症を呈した症例が報告されています。" },
            { q: "エトミデート含有製品の外観の特徴として正しいものはどれですか？", options: ["必ず「危険」と書かれている", "通常の電子タバコ用リキッドと見分けがつかない", "常に真っ黒な液体である", "注射器に入って販売されている"], a: 1, exp: "通常の電子タバコ製品と外観で見分けることは困難であり、製品名や成分表示が不明瞭なものが多いです。" },
            { q: "「スペースオイル」を使用した後、二日酔いのような不快感はどうなると言われていますか？", options: ["非常に強く残る", "1週間続く", "ほとんど残らない（後遺症がない）", "頭痛だけが残る"], a: 2, exp: "使用後に二日酔いのような不快感が残らないことも、若者の間で広まる一因とされています。" },
            { q: "台湾において、エトミデートはどのような扱いになっていますか？（2024年の状況）", options: ["完全に合法化された", "医薬品としてのみ薬局で買える", "毒品危害防制條例により規制対象となった", "タバコと同じ扱いである"], a: 2, exp: "乱用の急増を受け、エトミデートを毒品危害防制條例の規制対象とし、取り締まりを強化しています。" },
            { q: "エトミデートの「離脱症状」として報告されているものはどれですか？", options: ["異常な食欲増進", "深い睡眠", "不安、イライラ、不眠、幻覚", "視力の向上"], a: 2, exp: "乱用を中断すると、不安、イライラ、不眠、幻覚、自殺念慮などの激しい離脱症状が現れることが報告されています。" },

            // 第3章：救急現場での対応
            { q: "消防職員が現場で「電子タバコを吸った直後に倒れた若者」に遭遇した場合、疑うべき中毒原因物質の一つはどれですか？", options: ["ニコチンのみ", "カフェイン", "エトミデート（ゾンビたばこ）", "ビタミンC"], a: 2, exp: "若年層での電子タバコ使用後の急激な意識障害や不随意運動は、エトミデート含有製品の使用を示唆する重要な兆候です。" },
            { q: "エトミデートの乱用による死亡例の原因として考えられるものはどれですか？", options: ["呼吸停止や心停止", "老衰", "栄養過多", "ビタミン中毒"], a: 0, exp: "過量摂取や他の中枢神経抑制薬との併用により、呼吸抑制や心血管虚脱（心停止）に至り、死亡するリスクがあります。" },
            { q: "エトミデートと併用することで、致死的なリスクが劇的に高まる物質はどれですか？", options: ["水", "アルコールや他の中枢神経抑制薬", "砂糖", "酸素"], a: 1, exp: "アルコールやベンゾジアゼピンなどと併用すると、呼吸抑制や意識障害が相乗的に増強され、致死的になる危険性が高まります。" },
            { q: "「ゾンビたばこ」の乱用が日本国内で最初に社会問題化したとされる地域はどこですか？", options: ["北海道", "沖縄県", "京都府", "新潟県"], a: 1, exp: "2024年頃から沖縄県で先行して蔓延が確認され、その後全国へ拡大した経緯があります。" },
            { q: "エトミデートが含まれるリキッドを所持している人を発見した場合、消防職員や警察官はどうすべきですか？", options: ["その場で一緒に吸ってみる", "警察への通報や適切な法的手続きを行う", "無害なので無視する", "販売店を紹介してもらう"], a: 1, exp: "指定薬物であり所持自体が違法です。適切な法執行機関への通報や連携が必要です。" },
            { q: "救急現場でエトミデートを使用してRSIを行う際、必ず準備しておくべきものは何ですか？", options: ["輸血セット", "人工呼吸・気道確保の準備と循環作動薬", "胃洗浄セット", "透析装置"], a: 1, exp: "RSIを行う際は、無呼吸や血圧変動に対応できるよう、確実な気道確保器具や昇圧剤などの蘇生用資機材を即座に使用できる状態で準備する必要があります。" },
            { q: "エトミデート投与後に「副腎クリーゼ」が疑われるショック状態に対し、投与すべき薬剤はどれですか？", options: ["エトミデートの追加", "ヒドロコルチゾン（ステロイド）", "抗生物質", "ビタミン剤"], a: 1, exp: "不足しているコルチゾールを補充するためにヒドロコルチゾンなどのステロイド投与が必要です。" },
            { q: "救急搬送された患者が「電子タバコを吸って意識を失った」という情報がある場合、現場で確認すべき身体所見はどれですか？", options: ["髪の色", "不随意運動（震え・硬直）や呼吸状態", "足のサイズ", "歯の本数"], a: 1, exp: "中毒の特徴である、ミオクローヌス（不随意運動）、筋硬直、および呼吸抑制の有無を確認することが重要です。" },
            { q: "エトミデートを使用したRSIにおいて、鎮静後に投与する薬剤として一般的なのはどれですか？", options: ["利尿薬", "筋弛緩薬", "降圧薬", "解熱薬"], a: 1, exp: "鎮静薬（エトミデート）で意識を消失させた直後に、筋弛緩薬を投与して速やかに挿管条件を整えます。" },
            { q: "エトミデート投与による「呼吸抑制」の特徴として正しいものはどれですか？", options: ["完全に呼吸が止まることは絶対にない", "一過性の無呼吸や低換気が起こることがある", "呼吸数が劇的に増加する", "咳が止まらなくなる"], a: 1, exp: "用量依存的に一時的な無呼吸（Apnea）や低換気を引き起こすことがあります。" },
            { q: "エトミデートの過剰投与に対する特異的な解毒剤（拮抗薬）はありますか？", options: ["ナロキソンがある", "フルマゼニルがある", "特異的な解毒剤はない", "アトロピンがある"], a: 2, exp: "特異的な拮抗薬（解毒剤）は存在しません。治療は支持療法が中心となります。" },
            { q: "敗血症性ショックの患者に対し、エトミデートを使用するかどうかの判断において、現在推奨される傾向はどれですか？", options: ["積極的に推奨される", "副腎抑制リスクのため慎重になる（代替薬検討等）", "絶対に使用してはならない", "治療効果が高まるため必須である"], a: 1, exp: "副腎不全や死亡率増加のリスクが議論されており、ケタミンの使用や、使用時のステロイド補充が考慮されます。" },
            { q: "エトミデートを継続的に点滴投与（維持麻酔や長期鎮静）することは推奨されますか？", options: ["推奨される", "強く推奨される", "推奨されない", "小児のみ推奨される"], a: 2, exp: "副腎抑制のリスクから、持続投与は禁忌または推奨されていません。" },
            { q: "エトミデートの使用が「10歳未満の小児」に対して推奨されない理由は何ですか？", options: ["効果が強すぎるため", "安全性と有効性のデータがないため", "注射が痛すぎるため", "法律で禁止されているため"], a: 1, exp: "小児に対する麻酔導入の安全性と有効性は確立していないため、推奨されていません。" },
            { q: "エトミデートによるミオクローヌスが「てんかん発作」と異なる点は何ですか？", options: ["脳波上でてんかん波が見られない", "全身が動かない", "意識がはっきりしている", "数日間続く"], a: 0, exp: "ミオクローヌス時の脳波検査では、てんかん性の発作活動は確認されておらず、皮質下の脱抑制によるものとされています。" },
            { q: "救急現場で「ゾンビたばこ」使用者と思われる患者が暴れている場合、安全確保のために留意すべき点は？", options: ["強く拘束して無理やり話を聞く", "感染症や二次被害に注意し、警察と連携する", "そのまま放置して帰る", "一緒に中身を確認するために吸う"], a: 1, exp: "興奮・錯乱状態にある可能性があり、予測不能な行動をとるリスクがあります。自身の安全を確保し、警察等の支援を求めてください。" },
            { q: "エトミデートの「血行動態が安定している」という特徴は、どのような患者に有利ですか？", options: ["高血圧の患者", "低血圧や心機能が低下している患者", "頻脈の患者", "呼吸器疾患の患者"], a: 1, exp: "血圧を下げにくく心拍数への影響も少ないため、出血性ショックや重篤な心疾患を持つ患者の導入に適しています。" },
            { q: "エトミデートが「エトミデート・パラドックス」と呼ばれる現象に関連するのはなぜですか？", options: ["導入時は安定しているが、後に副腎不全でショックを起こす可能性があるから", "鎮静薬なのに興奮するから", "名前が覚えにくいから", "痛みを止めるが意識はなくならないから"], a: 0, exp: "導入直後の血行動態は安定している（メリット）一方で、その後の副腎抑制により遅発性のショックを引き起こすリスク（デメリット）があるという矛盾を指します。" },
            { q: "救急隊員がエトミデート（または疑いのある液体）を皮膚に付着させてしまった場合、どうすべきですか？", options: ["自然に乾くのを待つ", "すぐに大量の水と石鹸で洗い流す", "アルコールで拭き取る", "なめる"], a: 1, exp: "経皮吸収の可能性も否定できないため、皮膚についた場合は速やかに洗い流し、曝露を防ぐのが基本です。" },
            { q: "エトミデートに関する正しい認識はどれですか？", options: ["日本では市販薬として買える", "合法的なリラックスハーブである", "医療用途以外での所持・使用は違法な危険薬物", "副作用は全くない安全な薬である"], a: 2, exp: "2025年5月以降、指定薬物として厳しく規制されており、医療等の正当な目的以外での所持や使用は違法です。" }
        ];

        let currentQuestions = [];
        let userAnswers = {}; // key: questionIndex (in currentQuestions array), value: selected option index

        // Helper: Shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Start Quiz
        function startQuiz() {
            // Select 10 random questions
            const shuffled = shuffleArray([...allQuestions]);
            currentQuestions = shuffled.slice(0, 10);
            userAnswers = {};

            // Render questions
            const container = document.getElementById('question-container');
            container.innerHTML = '';
            
            currentQuestions.forEach((qObj, index) => {
                const qHtml = `
                <div class="bg-white rounded-lg luxury-shadow overflow-hidden border border-slate-200">
                    <div class="bg-slate-50 px-6 py-4 border-b border-slate-200 flex items-start gap-3">
                        <span class="bg-amber-700 text-white text-xs font-bold px-2 py-1 rounded mt-0.5">問 ${index + 1}</span>
                        <h3 class="text-lg font-medium text-slate-800 leading-snug">${qObj.q}</h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-3">
                            ${qObj.options.map((opt, optIdx) => `
                                <div class="flex items-center">
                                    <input type="radio" id="q${index}_opt${optIdx}" name="q${index}" value="${optIdx}" 
                                        class="hidden option-radio" onchange="selectOption(${index}, ${optIdx})">
                                    <label for="q${index}_opt${optIdx}" 
                                        class="w-full block px-4 py-3 border border-slate-300 rounded-md cursor-pointer hover:bg-slate-50 transition-colors duration-200 select-none text-slate-700">
                                        <span class="font-bold mr-2 text-slate-400">${['A', 'B', 'C', 'D'][optIdx]}.</span> ${opt}
                                    </label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                `;
                container.innerHTML += qHtml;
            });

            // Toggle screens
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            window.scrollTo(0, 0);
        }

        // Handle selection
        window.selectOption = function(qIdx, optIdx) {
            userAnswers[qIdx] = optIdx;
        };

        // Grade Quiz
        window.gradeQuiz = function() {
            // Validate all answered? (Optional, currently allowing skipped)
            const unanswered = currentQuestions.length - Object.keys(userAnswers).length;
            if(unanswered > 0) {
                if(!confirm(`未回答の問題が ${unanswered} 問あります。採点してよろしいですか？`)) return;
            }

            let score = 0;
            const reviewContainer = document.getElementById('review-container');
            reviewContainer.innerHTML = '';

            currentQuestions.forEach((qObj, index) => {
                const userChoice = userAnswers[index];
                const isCorrect = userChoice === qObj.a;
                if (isCorrect) score++;

                const choiceText = userChoice !== undefined ? `<strong>${['A', 'B', 'C', 'D'][userChoice]}</strong>. ${qObj.options[userChoice]}` : '<span class="text-gray-400">未回答</span>';
                const correctText = `<strong>${['A', 'B', 'C', 'D'][qObj.a]}</strong>. ${qObj.options[qObj.a]}`;

                // Build review card
                const reviewHtml = `
                    <div class="bg-white rounded-lg luxury-shadow p-6 border-l-4 ${isCorrect ? 'border-green-500' : 'border-red-500'}">
                        <div class="flex items-center gap-2 mb-2">
                             <span class="text-sm font-bold text-slate-400">問 ${index + 1}</span>
                             ${isCorrect 
                                ? '<span class="text-green-600 font-bold bg-green-100 px-2 py-0.5 rounded text-xs">正解</span>' 
                                : '<span class="text-red-600 font-bold bg-red-100 px-2 py-0.5 rounded text-xs">不正解</span>'}
                        </div>
                        <h4 class="font-medium text-slate-800 mb-4">${qObj.q}</h4>
                        
                        <div class="grid md:grid-cols-2 gap-4 text-sm mb-4">
                            <div class="p-3 bg-slate-50 rounded">
                                <span class="block text-xs text-slate-400 mb-1">あなたの回答</span>
                                ${choiceText}
                            </div>
                            <div class="p-3 bg-green-50 rounded border border-green-100">
                                <span class="block text-xs text-green-600 mb-1">正解</span>
                                <div class="text-green-800">${correctText}</div>
                            </div>
                        </div>
                        
                        <div class="text-sm text-slate-600 bg-slate-50 p-4 rounded leading-relaxed border border-slate-100">
                            <span class="font-bold text-amber-700 block mb-1">【解説】</span>
                            ${qObj.exp}
                        </div>
                    </div>
                `;
                reviewContainer.innerHTML += reviewHtml;
            });

            // Set Score
            document.getElementById('score-display').textContent = score;
            const msgEl = document.getElementById('score-message');
            if(score === 10) msgEl.textContent = "素晴らしい！全問正解です。知識は完璧です。";
            else if(score >= 8) msgEl.textContent = "大変優秀です。細かい点を確認して満点を目指しましょう。";
            else if(score >= 6) msgEl.textContent = "合格ラインです。間違えた箇所を復習しましょう。";
            else msgEl.textContent = "復習が必要です。解説をよく読んで知識を定着させましょう。";

            // Switch to result screen
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            window.scrollTo(0, 0);
        };

        // Restart
        window.restartQuiz = function() {
            startQuiz();
        };

    </script>
</body>
</html>
